<eb-container>
  <ng-container *transloco="let t">
    <div class="module-detail">
      @if (store.isLoading()) {
        <div class="module-detail__loading">
          {{ t('common.loading') }}
        </div>
      } @else if (module(); as mod) {
        <article class="module-detail__content">
          <eb-card [hoverable]="false">
            <header card-header>
              <div class="module-detail__header-actions">
                <div class="module-detail__header-left">
                  <eb-button
                    routerLink="/modules"
                    [ariaLabel]="t('modules.detail.backToList')"
                    class="module-detail__back"
                  >
                    <ng-container icon>
                      <eb-icon [name]="ICONS.ARROW_LEFT" size="sm" />
                    </ng-container>
                    {{ t('modules.detail.backToList') }}
                  </eb-button>

                  @if (mod.repoUrl) {
                    <a
                      [href]="mod.repoUrl"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="module-detail__source-link"
                    >
                      <eb-button variant="secondary" [ariaLabel]="t('modules.detail.viewSource')">
                        <ng-container icon>
                          <eb-icon [name]="ICONS.CODE" size="sm" />
                        </ng-container>
                        {{ t('modules.detail.viewSource') }}
                      </eb-button>
                    </a>
                  }
                </div>

                <!-- Top Navigation -->
                <ng-container *ngTemplateOutlet="navControls; context: { $implicit: 'header' }" />
              </div>

              <h1 class="module-detail__title">{{ t('modules.data.' + mod.id + '.title') }}</h1>

              <p class="module-detail__subtitle">
                {{ t('modules.data.' + mod.id + '.description') }}
              </p>

              <div class="module-detail__badges">
                <eb-badge
                  [variant]="getStatusVariant(mod.status)"
                  [content]="t('modules.statuses.' + mod.status)"
                  [ariaLabel]="
                    t('modules.detail.statusLabel', { status: t('modules.statuses.' + mod.status) })
                  "
                  position="inline"
                />
                <eb-badge
                  [variant]="getCategoryVariant(mod.category)"
                  [content]="t('modules.categories.' + mod.category)"
                  [ariaLabel]="
                    t('modules.detail.categoryLabel', {
                      category: t('modules.categories.' + mod.category),
                    })
                  "
                  position="inline"
                />
              </div>
            </header>

            <div class="module-detail__body" card-body>
              <eb-stack spacing="lg">
                <!-- Features -->
                <div class="module-detail__section">
                  <h2 class="module-detail__section-title">{{ t('modules.detail.features') }}</h2>
                  <ul class="module-detail__features">
                    @for (feature of mod.features; track $index) {
                      <li class="module-detail__features-item">
                        <eb-icon
                          [name]="ICONS.CHECK"
                          size="sm"
                          class="module-detail__features-icon"
                        />
                        {{ feature }}
                      </li>
                    }
                  </ul>
                </div>

                <!-- Tech Stack -->
                <div class="module-detail__section">
                  <h2 class="module-detail__section-title">{{ t('modules.detail.techStack') }}</h2>
                  <div class="module-detail__tech-stack">
                    @for (tech of mod.techStack; track tech) {
                      <eb-badge
                        variant="secondary"
                        [content]="tech"
                        [ariaLabel]="t('modules.detail.technologyLabel', { technology: tech })"
                        position="inline"
                      />
                    }
                  </div>
                </div>

                <!-- Tags -->
                <div class="module-detail__section">
                  <h2 class="module-detail__section-title">{{ t('modules.detail.tags') }}</h2>
                  <div class="module-detail__tags">
                    @for (tag of mod.tags; track tag) {
                      <span class="module-detail__tags-tag">{{ tag }}</span>
                    }
                  </div>
                </div>
              </eb-stack>
            </div>

            <footer class="module-detail__footer" card-footer>
              <!-- Bottom Navigation -->
              <ng-container *ngTemplateOutlet="navControls; context: { $implicit: 'footer' }" />
            </footer>
          </eb-card>

          <!-- Reusable Navigation Template -->
          <ng-template #navControls let-placement>
            <div
              class="module-detail__nav"
              [class.module-detail__nav--header]="placement === 'header'"
              [class.module-detail__nav--footer]="placement === 'footer'"
            >
              @if (adjacentModules().prev; as prev) {
                <eb-button
                  variant="secondary"
                  [routerLink]="['/modules', prev.id]"
                  class="module-detail__nav-prev"
                  [ariaLabel]="t('modules.detail.previousModule')"
                >
                  <ng-container icon>
                    <eb-icon [name]="ICONS.ARROW_LEFT" size="sm" />
                  </ng-container>
                  {{ t('modules.detail.previousModule') }}
                </eb-button>
              }
              @if (adjacentModules().next; as next) {
                <eb-button
                  variant="secondary"
                  [routerLink]="['/modules', next.id]"
                  class="module-detail__nav-next"
                  [ariaLabel]="t('modules.detail.nextModule')"
                >
                  {{ t('modules.detail.nextModule') }}
                  <ng-container icon>
                    <eb-icon [name]="ICONS.ARROW_RIGHT" size="sm" />
                  </ng-container>
                </eb-button>
              }
            </div>
          </ng-template>
        </article>
      } @else {
        <div class="module-detail__not-found">
          <eb-icon [name]="ICONS.SEARCH" size="xl" [decorative]="true" />
          <h2>{{ t('modules.detail.notFound') }}</h2>
          <p>{{ t('modules.detail.notFoundMessage') }}</p>
          <eb-button
            routerLink="/modules"
            variant="primary"
            [ariaLabel]="t('modules.detail.backToList')"
          >
            {{ t('modules.detail.backToList') }}
          </eb-button>
        </div>
      }
    </div>
  </ng-container>
</eb-container>
